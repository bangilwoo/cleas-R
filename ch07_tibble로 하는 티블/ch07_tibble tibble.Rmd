---
title: "tibble로하는티블"
author: "bangilwoo"
html_document:
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## 7.1 들어가기

현재 전통적인 ‘데이터프레임’ 대신 ‘티블’을 가지고 작업 한다. <br>
티블도 ‘데이터프레임’이지만, 편리하게 사용 할 수 있도록 오래된 동작을 수정한 것 이다. <br>
기존의 유용했던 동작들이 현재는 유용하지 않을 수 있다. <br>
기존 코드를 손상시키지 않으면서 베이스 R을 변경하기가 어렵기 때문에 대부분의 변화는 패키지로 나타난다.

### 7.1.1 준비하기

Tidyverse 패키지의 핵심 중 하나인 tibble 패키지 살펴보기

```{r}
library(tidyverse)
```

## 7.2 티블생성하기

대부분의 함수는 tidyverse의 통합 특성 중 하나인 티블을 생성한다. <br>
대부분의 R패키지는 일반적인 데이터프레임을 사용하므로, 데이터프레임을 티블로 강제 변경해야 할 경우가 있다.

```{r}
as_tibble(iris)
```

- tibble()을 사용하여 개별 벡터로부터 새로운 티블을 만들 수 있다.
- tibble()은 길이가 1인 입력을 자동으로 재사용하며, 아래에 보이는 것 같이 방금 만든 변수를 참조할 수 있다.

```{r}
tibble(
x = 1:5,
y = 1,
z = x ^ 2 + y
)
```

- tibble()은 동작의 규모가 훨씬 작다는 것에 주의해야 한다.
- 입력의 유형을 절대로 변경하지 않고, 변수의 이름을 바꾸거나 행 이름을 생성하지 않는다.

티블은 R 변수명으로는 유효하지 않은 이름도 열 이름으로 가질 수 있다. <br>
문자로 시작하지 않거나 공백과 같은 비정상적인 문자가 포함될 수 있다. <br>
이 변수들을 참조하려면 역따옴표로 감싸야 한다. 

```{r}
tb <- tibble(
`:)` = "스마일",
` ` = "스페이스",
`2000` = "숫자"
)

tb
```

- ggplot2, dplyr, tidyr 과 같은 패키지에서 이러한 변수로 작업할 때도 역따옴표가 필요하다.

티블을 만드는 또 다른 방법은 tribble()을 사용하는 것이다. <br>
Tribble()은 코드로 데이터를 입력하기 위해 고안되었다. <br>
열 헤더는 공식으로 정의되고(~시작), 입력은 쉼표로 구분된다.

```{r}
tribble(
~x, ~y, ~z,
 #--|--|----
"a", 2, 3.6,
"b", 1, 8.5
)
```

- 헤더의 위치를 명확히 하기위해 주석을 추가 하기도 한다.

## 7.3 티블 vs 데이터프레임

티블과 전통적 데이터프레임의 용법에 두가지 주요 차이점이 있다.
- 화면 출력
- 서브셋

### 7.3.1 화면출력

티블에는 처음 10개의 행과, 화면에 들어가는 열 모두를 보여주는 정교한 화면 출력 방법이 있다. <br>
이를 이용하면 대용량 데이터 작업을 훨씬 쉽게 할 수 있다. <br>
또한 str()에서 가져온 기능으로 각 열 유형과 열 이름을 표시한다.

```{r}
tibble(
a = lubridate::now() + runif(1e3) * 86400,
b = lubridate::today() + runif(1e3) *30,
c = 1:1e3,
d = runif(1e3),
e = sample(letters, 1e3, replace = TRUE)
)
```

티블은 큰 데이터프레임을 화면 출력할 때 실수로 콘솔을 넘어가지 않도록 설계 되었다. <br>
그러나 때로는 기본 디스플레이보다 더 많은 출력이 필요하곤 하다. 도움이 될 수 있는 몇 가지 옵션이 있다. <br>
먼저 데이터프레임을 명시적으로 print()로 화면 출력하고 디스플레이의 행수(n)와 너비(w)를 제어할 수 있다, width = Inf를 하면 모든 열을 표시한다.

```{r}
nycflights13::flights %>%
print(n = 10, width = Inf)
```

- options(tibble.print_max = n, tibble.print_min = m): m행 이상인 경우, n행만 출력한다. 
- option(dplyr.print_min = Inf): 모든 행을 항상 표시할때 사용한다.
- Option(tibble.width = Inf): 화면 너비와 상관없이 항상 모든 열을 출력한다.
- package?tibble패키지 도움말을 찾아보면 옵션의 전체 목록을 볼 수 있다.

마지막 방법은 전체 데이터셋을 스크롤하여 볼 수 있도록 RStudio의 내장 데이터 뷰어를 사용하는 것이다.<br>
긴 데이터 연쇄 작업의 마지막에도 이 방법은 유용하다.

```{r}
nycflights13::flights %>%
view()
```

### 7.3.2 서브셋하기

변수 하나를 추출하려면 새로운 도구인 $ 및 [[이 필요하다. [[는 이름이나 위치로 추출할 수 있다.

```{r}
df <- tibble(
x = runif(5),
y = rnorm(5)
)
```


` ` #이름으로 추출 ex)x, y
 
```{r} 
df$x
```
 
```{r} 
df[["x"]]
```


` ` #위치로 추출 ex)1, 2
 
```{r}
df[[1]]

```

파이프(%>%)에서 사용하려면 특별한 플레이스홀더인 .을 사용해야 한다.

```{r}
df %>% .$x
``` 

 
``` {r}
df %>% .[["x"]]
``` 

절대로 부분 매칭을 사용하지 않으며, 접근하려는 열이 존재하지 않는 경우에는 경고를 생성한다.

## 7.4 이전 코드와 상호작용

일부 오래된 함수는 티블에서 동작하지 않는다. <br>
이러한 함수를 사용하려면 as.data.frame()을 사용하여 티블을 data.frame으로 되돌려야 한다.

```{r}
class(as.data.frame(tb))
```
 
- 오래된 함수 중 일부가 티블에서 작동하지 않는 주된 이유는 [함수 때문이다.
- Dplyr::filter()와 dplyr::select()가 같은 문제를 더 명확한 코드로 해결할 수 있기 때문이다.
- 베이스 R의 데이터프레임을 사용하면 [는 어떨 때는 데이터프레임을 반환하고, 어떨 때는 벡터를 반환한다. 티블에서 [는 항상 다른 티블을 반환한다.
 
> 7.4.1 연습문제

` ` 1.어떤 객체가 tibble 인지 알 수 있는 방법은 무엇인가? (힌트: 일반 데이터프레임인  mtcars  를 화면출력해보라.)

- 출력보기, class, is_tibble()

` ` 2.data.frame  과 이에 해당하는 tibble 에서 다음 연산들을 비교하고 차이를 밝혀보라. 차이점은 무엇인가? 데이터프레임의 기본 동작이 혼란스러운 점은 무엇인가?

```{r}
df <- data.frame(abc = 1, xyz = "a")
df$x
df[, "xyz"]
df[, c("abc", "xyz")]
```

` ` 3.객체에 변수 이름을 저장하고 있는 경우 (예:  var <- "mpg" ), tibble 에서 이 참조 변수를 어떻게 추출할 수 있는가?

- $, [[]], enframe()

` ` 4.다음의 데이터프레임에서 비구문론적 이름을 참조하는 방법을 연습해보라.

a. 1이라는 이름의 변수를 추출하기.

```{r}
enframe(1:3)
```

b. 1 vs 2 의 산점도를 플롯팅 하기.

c. 열 2 를 열 1 로 나누어, 3 이라는 새로운 열을 생성하기.

d. 열의 이름을 one, two, three 로 변경하기

```{r}
enframe(list(one = 1, two = 2:3, three = 4:6))
```

```{r}
annoying <- tibble(
  `1` = 1:10,
  `2` = `1` * 2 + rnorm(length('1'))
)
```

` ` 5.tibble::enframe()  은 어떤 동작을 하는가? 언제 사용하겠는가?

- 변수추출

` ` 6.tibble 의 바닥글(footer)에 화면출력되는 열 이름의 개수를 제어하는 옵션은 무엇인가?

- print(노출하고 싶은 열의 개수 입력)
